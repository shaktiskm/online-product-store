{"version":3,"sources":["../../lib/middleware_services/mwAuthenticateRequest.es6"],"names":["JWT","require","ApiError","log","mwAuthenticateRequest","req","res","next","NODE_ENV","process","env","nodeEnv","config","Object","freeze","secret","app","get","jwtInstance","tokenRegex","RegExp","token","header","authorization","authorize","info","test","error","err","id","split","verifyToken","then","data","user","failure","module","exports"],"mappings":";;AAAA,IAAMA,MAAMC,QAAQ,0BAAR,CAAZ;AAAA,IACEC,WAAWD,QAAQ,kBAAR,CADb;AAAA,IAEEE,MAAMF,QAAQ,mBAAR,CAFR;;AAIA,SAASG,qBAAT,CAA+BC,GAA/B,EAAoCC,GAApC,EAAyCC,IAAzC,EAA+C;AAEzC,MAACC,QAAD,GAAaC,QAAQC,GAArB,CAACF,QAAD;AAAA,MACFG,OADE,GACQH,YAAY,OADpB;AAAA,MAEFI,MAFE,GAEOC,OAAOC,MAAP,CAAcb,QAAQ,kBAAkBU,OAA1B,CAAd,CAFP;AAAA,MAGFI,MAHE,GAGOV,IAAIW,GAAJ,CAAQC,GAAR,CAAY,WAAZ,CAHP;AAAA,MAIFC,WAJE,GAIY,IAAIlB,GAAJ,CAAQe,MAAR,CAJZ;AAAA,MAKFI,UALE,GAKW,IAAIC,MAAJ,CAAW,gBAAX,CALX;AAAA,MAMFC,KANE,GAMMhB,IAAIiB,MAAJ,CAAW,eAAX,CANN;;;AAQJ,MAAI,CAACV,OAAOW,aAAP,CAAqBC,SAA1B,EAAqC;AACnCrB,QAAIsB,IAAJ,CAAS,yEAAT;AACA,WAAOlB,MAAP;AACD;;AAED,MAAI,CAACc,KAAD,IAAU,CAACF,WAAWO,IAAX,CAAgBL,KAAhB,CAAf,EAAuC;AACrClB,QAAIwB,KAAJ,CAAU,gFAAV;AACA,QAAIC,MAAM,IAAI1B,QAAJ,CAAaG,IAAIwB,EAAjB,EAAqB,GAArB,EAA0B,cAA1B,EAA0C,iDAA1C,EAA6F,EAA7F,CAAV;;AAEA,WAAOtB,KAAKqB,GAAL,CAAP;AACD;;AAEDP,UAAQA,MAAMS,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAR;;AAEAZ,cACGa,WADH,CACeV,KADf,EAEGW,IAFH,CAEQ,gBAAQ;AACZ7B,QAAIsB,IAAJ,CAAS,8EAAT,EAAyFQ,IAAzF;AACA5B,QAAI6B,IAAJ,GAAWD,IAAX;AACA,WAAO1B,MAAP;AAED,GAPH,EAOK,mBAAW;AACZJ,QAAIwB,KAAJ,CAAU,8DAAV,EAA0EQ,OAA1E;AACA,WAAO5B,KAAK,IAAIL,QAAJ,CAAaG,IAAIwB,EAAjB,EAAqB,GAArB,EAA0B,cAA1B,EAA0C,iDAA1C,EAA6F,EAA7F,CAAL,CAAP;AACD,GAVH;AAWD;;AAEDO,OAAOC,OAAP,GAAiBjC,qBAAjB","file":"mwAuthenticateRequest.js","sourcesContent":["const JWT = require(\"../util/JWTImplementaion\"),\n  ApiError = require(\"../util/apiError\"),\n  log = require(\"../util/ApiLogger\");\n\nfunction mwAuthenticateRequest(req, res, next) {\n\n  let {NODE_ENV} = process.env,\n    nodeEnv = NODE_ENV || \"local\",\n    config = Object.freeze(require(\"../../config/\" + nodeEnv)),\n    secret = req.app.get(\"secretKey\"),\n    jwtInstance = new JWT(secret),\n    tokenRegex = new RegExp(\"^(b|B)earer\\\\s\"),\n    token = req.header(\"Authorization\");\n\n  if (!config.authorization.authorize) {\n    log.info(\"mwAuthenticateRequest()//Authentication is disabled by configuration...\");\n    return next();\n  }\n\n  if (!token || !tokenRegex.test(token)) {\n    log.error(\"mwAuthenticateRequest()//Authentication credentials were missing or incorrect.\");\n    let err = new ApiError(req.id, 401, \"Unauthorized\", \"Authentication credentials missing or incorrect\", \"\");\n\n    return next(err);\n  }\n\n  token = token.split(\" \")[1];\n\n  jwtInstance\n    .verifyToken(token)\n    .then(data => {\n      log.info(\"mwAuthenticateRequest()//Authentication Token verification done successfully\", data);\n      req.user = data;\n      return next();\n\n    }, failure => {\n      log.error(\"mwAuthenticateRequest()//Unable to verify the supplied token\", failure);\n      return next(new ApiError(req.id, 401, \"Unauthorized\", \"Authentication credentials missing or incorrect\", \"\"));\n    });\n}\n\nmodule.exports = mwAuthenticateRequest;\n"]}