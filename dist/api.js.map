{"version":3,"sources":["../lib/api.es6"],"names":["express","require","bodyparser","methodOverride","checkEnvironmentVariables","ApiError","mwAllowCrossDomain","mwAuthenticateRequest","mwErrorHandler","mwAddRequestId","mwGenerateUserToken","productRouter","NODE_ENV","process","env","nodeEnv","config","Object","freeze","urlPrefix","app","environmentVariables","firstLevelAuthTest","environmentVariableChecker","isEnabled","set","http","port","secretKey","use","json","get","req","res","send","post","notFoundHandler","next","apiError","listen","console","log","module","exports"],"mappings":";;AAAA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AAAA,IACEC,aAAaD,QAAQ,aAAR,CADf;AAAA,IAEEE,iBAAiBF,QAAQ,iBAAR,CAFnB;AAAA,IAGEG,4BAA4BH,QAAQ,kCAAR,CAH9B;AAAA,IAIEI,WAAWJ,QAAQ,iBAAR,CAJb;AAAA,IAKEK,qBAAqBL,QAAQ,0CAAR,CALvB;AAAA,IAMEM,wBAAwBN,QAAQ,6CAAR,CAN1B;AAAA,IAOEO,iBAAiBP,QAAQ,sCAAR,CAPnB;AAAA,IAQEQ,iBAAiBR,QAAQ,sCAAR,CARnB;AAAA,IASES,sBAAsBT,QAAQ,2CAAR,CATxB;AAAA,IAUEU,gBAAgBV,QAAQ,qBAAR,CAVlB;;AAYI,IAACW,QAAD,GAAaC,QAAQC,GAArB,CAACF,QAAD;AAAA,IACFG,OADE,GACQH,YAAY,OADpB;AAAA,IAEFI,MAFE,GAEOC,OAAOC,MAAP,CAAcjB,QAAQ,eAAec,OAAvB,CAAd,CAFP;AAAA,IAGFI,SAHE,GAGUH,OAAOG,SAHjB;AAAA,IAIFC,GAJE,GAIIpB,SAJJ;AAAA,IAKFqB,oBALE,GAKqBpB,QAAQ,gCAAR,CALrB;AAAA,IAMFqB,kBANE,GAMoBP,YAAY,OAAb,GACjBd,QAAQ,sDAAR,CADiB,GAEjB,IARF;;AAUJ;AACA;AACA,IAAIe,OAAOO,0BAAP,CAAkCC,SAAtC,EAAiD;AAC/CpB,4BAA0BiB,oBAA1B;AACD;;AAED;AACAD,IAAIK,GAAJ,CAAQ,MAAR,EAAgBT,OAAOU,IAAP,CAAYC,IAA5B;AACAP,IAAIK,GAAJ,CAAQ,WAAR,EAAqBT,OAAOY,SAA5B;;AAEAR,IAAIS,GAAJ,CAAQvB,kBAAR;AACAc,IAAIS,GAAJ,CAAQ3B,WAAW4B,IAAX,EAAR;;AAEA;AACAV,IAAIW,GAAJ,CAAWZ,SAAX,mBAAoC,UAACa,GAAD,EAAMC,GAAN,EAAc;AAChDA,MAAIC,IAAJ,CAAS,EAAC,OAAO,IAAR,EAAT;AACD,CAFD;;AAIA;AACAd,IAAIS,GAAJ,CAAQpB,cAAR;;AAEA;AACAW,IAAIe,IAAJ,CAAS,gBAAT,EAA2BzB,mBAA3B;;AAEA;AACAU,IAAIS,GAAJ,CAAQtB,qBAAR;;AAEA;AACAa,IAAIS,GAAJ,CAAQ,WAAR,EAAqBlB,aAArB;;AAEA,IAAII,YAAY,OAAhB,EAAyB;AACvBK,MAAIS,GAAJ,CAAQV,YAAY,wBAApB,EAA8CG,kBAA9C;AACD;;AAED,SAASc,eAAT,CAAyBJ,GAAzB,EAA8BC,GAA9B,EAAmCI,IAAnC,EAAyC;AACvC,MAAIC,WAAW,IAAIjC,QAAJ,CAAa,UAAb,EAAyB,wBAAzB,EAAmD,EAAnD,EAAuD,GAAvD,CAAf;;AAEA,SAAOgC,KAAKC,QAAL,CAAP;AACD;;AAEDlB,IAAIS,GAAJ,CAAQO,eAAR;;AAEAhB,IAAIS,GAAJ,CAAQ1B,cAAR;AACAiB,IAAIS,GAAJ,CAAQrB,cAAR;;AAEAY,IAAImB,MAAJ,CAAWnB,IAAIW,GAAJ,CAAQ,MAAR,CAAX,EAA4B,YAAM;AAChCS,UAAQC,GAAR,sCAA+CrB,IAAIW,GAAJ,CAAQ,MAAR,CAA/C;AACD,CAFD;;AAIAW,OAAOC,OAAP,GAAiBvB,GAAjB","file":"api.js","sourcesContent":["const express = require(\"express\"),\n  bodyparser = require(\"body-parser\"),\n  methodOverride = require(\"method-override\"),\n  checkEnvironmentVariables = require(\"./util/checkEnvironmentVariables\"),\n  ApiError = require(\"./util/apiError\"),\n  mwAllowCrossDomain = require(\"./middleware_services/mwAllowCrossDomain\"),\n  mwAuthenticateRequest = require(\"./middleware_services/mwAuthenticateRequest\"),\n  mwErrorHandler = require(\"./middleware_services/mwErrorHandler\"),\n  mwAddRequestId = require(\"./middleware_services/mwAddRequestId\"),\n  mwGenerateUserToken = require(\"./middleware_services/mwGenerateUserToken\"),\n  productRouter = require(\"./endpoints/product\");\n\nlet {NODE_ENV} = process.env,\n  nodeEnv = NODE_ENV || \"local\",\n  config = Object.freeze(require(\"../config/\" + nodeEnv)),\n  urlPrefix = config.urlPrefix,\n  app = express(),\n  environmentVariables = require(\"../config/environmentVariables\"),\n  firstLevelAuthTest = (nodeEnv === \"local\")\n    ? require(\"../test/dist/endpoints/helpers/firstLevelAuth/router\")\n    : null;\n\n// Checks the required enviro// Defines top middleware and routesnment variables\n// Logs the missing environment variables and exit the application\nif (config.environmentVariableChecker.isEnabled) {\n  checkEnvironmentVariables(environmentVariables);\n}\n\n// set the relevant config app wise\napp.set(\"port\", config.http.port);\napp.set(\"secretKey\", config.secretKey);\n\napp.use(mwAllowCrossDomain);\napp.use(bodyparser.json());\n\n// HealthCheck Endpoint --> GET ...v1/healthcheck\napp.get(`${urlPrefix}/healthcheck`, (req, res) => {\n  res.send({\"msg\": \"OK\"});\n});\n\n// App routes here\napp.use(mwAddRequestId);\n\n// JWT Authentication Implemented -- Generate Token\napp.post(\"/generateToken\", mwGenerateUserToken);\n\n// JWT Authentication Implemented -- Verify Token & User\napp.use(mwAuthenticateRequest);\n\n// Simple Product Add, Delete, Edit, Search Routes\napp.use(\"/products\", productRouter);\n\nif (nodeEnv === \"local\") {\n  app.use(urlPrefix + \"/first-level-auth-test\", firstLevelAuthTest);\n}\n\nfunction notFoundHandler(req, res, next) {\n  let apiError = new ApiError(\"NotFound\", \"Resource doesn't exist\", \"\", 404);\n\n  return next(apiError);\n}\n\napp.use(notFoundHandler);\n\napp.use(methodOverride);\napp.use(mwErrorHandler);\n\napp.listen(app.get(\"port\"), () => {\n  console.log(`Server is listening on port --> ${app.get(\"port\")}`);\n});\n\nmodule.exports = app;\n"]}